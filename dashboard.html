<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dịch Vụ - GENSAISHOP</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="container nav-inner">
            <div class="logo" onclick="window.location.href='index.html'">GENSAISHOP</div>
            <div class="menu-toggle" onclick="toggleMenu()"><i class="fa-solid fa-bars"></i></div>
            <div class="mobile-menu" id="mainMenu"></div>
        </div>
    </nav>

    <div class="container">
        <div style="margin-top:20px; display:flex; justify-content:space-between; align-items:center">
            <h3 style="font-size:16px">Chào, <span id="uName" style="color:blue">...</span></h3>
            <div style="background:white; padding:6px 12px; border-radius:50px; border:1px solid #ddd; font-size:14px">
                Số dư: <b id="uBal" style="color:green">0</b> đ
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <img src="https://placehold.co/300x200/222/fff?text=Blox+Fruit" alt="SP">
                <div class="card-body">
                    <div class="card-title">Cày Thuê Blox Fruit</div>
                    <div class="price">20.000đ</div>
                    <button class="btn-buy" onclick="openModal('Cày Blox Fruit', 20000)">MUA NGAY</button>
                </div>
            </div>
            <div class="card">
                <img src="https://placehold.co/300x200/0044aa/fff?text=400+Robux" alt="SP">
                <div class="card-body">
                    <div class="card-title">Nạp 400 Robux</div>
                    <div class="price">50.000đ</div>
                    <button class="btn-buy" onclick="openModal('400 Robux', 50000)">MUA NGAY</button>
                </div>
            </div>
        </div>
    </div>

    <div id="buyModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom:15px; font-size:18px">Xác nhận mua</h3>
            <p style="font-size:14px">Mua: <b id="mName">...</b></p>
            <p style="margin-bottom:15px; font-size:14px">Giá: <b id="mPrice" style="color:red">...</b></p>
            <input type="text" id="accUser" class="input-box" placeholder="Tài khoản Game...">
            <input type="password" id="accPass" class="input-box" placeholder="Mật khẩu Game...">
            <div style="font-size:11px; color:red; margin-bottom:15px; background:#fff2f2; padding:5px">⚠️ TẮT 2-STEP verification trước khi mua.</div>
            <button class="btn-primary" style="width:100%" onclick="processOrder()">THANH TOÁN</button>
            <button onclick="closeModal()" style="width:100%; background:none; border:none; margin-top:10px; cursor:pointer; font-size:13px">Hủy bỏ</button>
        </div>
    </div>

    <script>
        if(!localStorage.getItem('isLoggedIn')) window.location.href = 'login.html';

        // MENU LOGIC
        const uName = localStorage.getItem('myUser');
        const menuBox = document.getElementById('mainMenu');
        menuBox.innerHTML = `<div style="padding:10px; font-size:12px; color:#888; border-bottom:1px solid #eee">Acc: <b>${uName}</b></div>
            <a href="index.html" class="menu-item">Trang chủ</a><a href="dashboard.html" class="menu-item">Mua Dịch Vụ</a><a href="deposit.html" class="menu-item">Nạp Tiền</a><a href="history.html" class="menu-item">Lịch Sử Đơn</a><a href="#" onclick="doLogout()" class="menu-item logout">Đăng xuất</a>`;
        function toggleMenu() { menuBox.classList.toggle('active'); }
        function doLogout() { localStorage.removeItem('isLoggedIn'); window.location.href = 'index.html'; }

        // SHOP LOGIC
        let balance = parseInt(localStorage.getItem('myBalance'));
        document.getElementById('uName').innerText = uName;
        document.getElementById('uBal').innerText = balance.toLocaleString();

        let currentItem = {};
        function openModal(name, price) {
            currentItem = { name, price };
            document.getElementById('mName').innerText = name;
            document.getElementById('mPrice').innerText = price.toLocaleString() + 'đ';
            document.getElementById('buyModal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('buyModal').style.display = 'none'; }
        function processOrder() {
            let acc = document.getElementById('accUser').value;
            let pass = document.getElementById('accPass').value;
            if(!acc || !pass) return alert("Vui lòng nhập Acc/Pass game!");
            if(balance >= currentItem.price) {
                balance -= currentItem.price;
                localStorage.setItem('myBalance', balance);
                let history = JSON.parse(localStorage.getItem('myHistory')) || [];
                history.unshift({ id: '#' + Math.floor(Math.random()*99999), service: currentItem.name, price: currentItem.price, acc: acc, date: new Date().toLocaleDateString(), status: 'Chờ xử lý' });
                localStorage.setItem('myHistory', JSON.stringify(history));
                alert("Mua thành công!");
                window.location.href = "history.html";
            } else { alert("Số dư không đủ! Vui lòng nạp thêm."); }
        }
    </script>
</body>
</html>
