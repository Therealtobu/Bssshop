<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cửa Hàng - GENSAISHOP</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="container nav-inner">
            <div class="logo" onclick="window.location.href='index.html'">GENSAISHOP</div>
            <div class="menu-toggle" onclick="toggleMenu()"><i class="fa-solid fa-bars"></i></div>
            <div class="mobile-menu" id="mainMenu"></div>
        </div>
    </nav>

    <div class="container">
        <div style="margin-top:20px; display:flex; justify-content:space-between; align-items:center">
            <h3 style="font-size:16px">Chào, <span id="uName" style="color:#3b82f6">...</span></h3>
            <div style="background:white; padding:6px 12px; border-radius:50px; border:1px solid #ddd; font-size:14px; font-weight:bold">
                Số dư: <span id="uBal" style="color:#22c55e">0</span>đ
            </div>
        </div>

        <h3 style="margin-top:20px; font-size:16px; border-left:4px solid black; padding-left:10px; text-transform: uppercase;">Vật Phẩm Bee Swarm</h3>
        
        <div class="grid">
            <div class="card">
                <img src="https://i.postimg.cc/7Lrp7X49/tum-voucherler-bee-swarm-13751871.png" alt="Bear Bee">
                <div class="card-body">
                    <div class="card-title">Bear Bee Voucher</div>
                    <div class="price">120.000đ</div>
                    <button class="btn-buy" onclick="openModal('Bear Bee Voucher', 120000)">MUA NGAY</button>
                </div>
            </div>

            <div class="card">
                <img src="https://i.postimg.cc/3wZbGT9c/tum-voucherler-bee-swarm-13751871-1.png" alt="Cub Buddy">
                <div class="card-body">
                    <div class="card-title">Cub Buddy Voucher</div>
                    <div class="price">80.000đ</div>
                    <button class="btn-buy" onclick="openModal('Cub Buddy Voucher', 80000)">MUA NGAY</button>
                </div>
            </div>

            <div class="card">
                <img src="https://i.postimg.cc/Px336Qg7/tum-voucherler-bee-swarm-13751871-2.png" alt="x2 Bee Gather">
                <div class="card-body">
                    <div class="card-title">x2 Bee Gather Voucher</div>
                    <div class="price">60.000đ</div>
                    <button class="btn-buy" onclick="openModal('x2 Bee Gather', 60000)">MUA NGAY</button>
                </div>
            </div>

            <div class="card">
                <img src="https://i.postimg.cc/WpyYgS6N/tum-voucherler-bee-swarm-13751871-3.png" alt="x2 Convert Speed">
                <div class="card-body">
                    <div class="card-title">x2 Convert Speed Voucher</div>
                    <div class="price">60.000đ</div>
                    <button class="btn-buy" onclick="openModal('x2 Convert Speed', 60000)">MUA NGAY</button>
                </div>
            </div>
        </div>
    </div>

    <div id="buyModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom:15px; font-size:18px; text-align: center;">XÁC NHẬN MUA</h3>
            <p style="font-size:14px">Vật phẩm: <b id="mName">...</b></p>
            <p style="margin-bottom:15px; font-size:14px">Giá tiền: <b id="mPrice" style="color:#ef4444">...</b></p>
            
            <label style="font-size:13px; font-weight:bold; display:block; margin-bottom:5px">Nhập tên tài khoản (Username):</label>
            <input type="text" id="accUser" class="input-box" placeholder="Ví dụ: RobloxPlayer123...">
            
            <button class="btn-primary" style="width:100%" onclick="processOrder()">THANH TOÁN NGAY</button>
            <button onclick="closeModal()" style="width:100%; background:none; border:none; margin-top:10px; cursor:pointer; font-size:13px; color: #888;">Quay lại</button>
        </div>
    </div>

    <script>
        if(!localStorage.getItem('isLoggedIn')) window.location.href = 'login.html';

        const uName = localStorage.getItem('myUser');
        const menuBox = document.getElementById('mainMenu');
        menuBox.innerHTML = `
            <div style="padding:10px; font-size:12px; color:#888; border-bottom:1px solid #eee">Acc: <b>${uName}</b></div>
            <a href="index.html" class="menu-item">Trang chủ</a>
            <a href="dashboard.html" class="menu-item">Shop Vật Phẩm</a>
            <a href="deposit.html" class="menu-item">Nạp Tiền</a>
            <a href="history.html" class="menu-item">Lịch Sử Đơn</a>
            <a href="#" onclick="doLogout()" class="menu-item logout">Đăng xuất</a>
        `;

        function toggleMenu() { menuBox.classList.toggle('active'); }
        function doLogout() { localStorage.removeItem('isLoggedIn'); window.location.href = 'index.html'; }

        let balance = parseInt(localStorage.getItem('myBalance')) || 0;
        document.getElementById('uName').innerText = uName;
        document.getElementById('uBal').innerText = balance.toLocaleString();

        let currentItem = {};

        function openModal(name, price) {
            currentItem = { name, price };
            document.getElementById('mName').innerText = name;
            document.getElementById('mPrice').innerText = price.toLocaleString() + 'đ';
            document.getElementById('accUser').value = ""; // Reset ô nhập mỗi lần mở
            document.getElementById('buyModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('buyModal').style.display = 'none'; }

        // ENGINE MUA HÀNG (ĐÃ SỬA: BỎ PASS)
        function processOrder() {
            let acc = document.getElementById('accUser').value;
            
            // Chỉ kiểm tra username
            if(!acc) return alert("Vui lòng nhập tên tài khoản game để nhận quà!");

            if(balance >= currentItem.price) {
                balance -= currentItem.price;
                localStorage.setItem('myBalance', balance);
                
                let history = JSON.parse(localStorage.getItem('myHistory')) || [];
                let newOrder = {
                    id: 'GS' + Math.floor(Math.random() * 90000 + 10000),
                    service: currentItem.name,
                    price: currentItem.price,
                    acc: acc, 
                    pass: "Không cần", // Đánh dấu cho Admin biết là không cần pass
                    date: new Date().toLocaleString('vi-VN'),
                    status: 'Chờ xử lý'
                };
                history.unshift(newOrder);
                localStorage.setItem('myHistory', JSON.stringify(history));

                alert("Mua thành công! Vui lòng chờ nhận vật phẩm trong game.");
                window.location.href = "history.html";
            } else {
                alert("Số dư không đủ. Vui lòng nạp thêm!");
            }
        }

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.menu-toggle') && !e.target.closest('.mobile-menu')) {
                menuBox.classList.remove('active');
            }
        });
    </script>
</body>
</html>
