<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Panel - GENSAISHOP</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .admin-card { background: #000; color: #fff; padding: 25px; border-radius: 20px; margin-bottom: 20px; }
        .order-card { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .acc-box { background: #f8fafc; padding: 12px; border-radius: 10px; margin: 10px 0; font-family: monospace; font-size: 13px; border-left: 4px solid #000; }
        .note-box { background: #fffbeb; color: #b45309; padding: 10px; border-radius: 8px; font-size: 13px; margin-bottom: 10px; border: 1px dashed #b45309; }
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-status { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: bold; font-size: 12px; cursor: pointer; color: #fff; }
        .input-price { width: 100%; padding: 8px; border: 2px solid #22c55e; border-radius: 6px; margin-bottom: 5px; }
    </style>
</head>
<body>
    <script>
        const pass = prompt("Nh·∫≠p m√£ b·∫£o m·∫≠t Admin:");
        if (pass !== "Gensai2026") { alert("M√£ sai!"); window.location.href = "../index.html"; }
    </script>
    <nav class="navbar"><div class="container nav-inner"><img class="logo-img" src="https://i.postimg.cc/SRwtHbrS/file-000000003c247208a974f17e7168edea-1-removebg-preview.png"><div class="menu-toggle" onclick="toggleMenu()"><i class="fa-solid fa-bars"></i></div><div class="mobile-menu" id="mainMenu"></div></div></nav>
    
    <div class="container">
        <div class="admin-card">
            <h2>Qu·∫£n L√Ω ƒê∆°n</h2>
            <p>ƒê∆°n c·∫ßn b√°o gi√°: <b id="quoteCount" style="color:#fbbf24">0</b></p>
        </div>
        <div class="history-switcher">
            <div id="tab-active" class="switch-btn active" onclick="setTab('active')">C·∫¶N X·ª¨ L√ù</div>
            <div id="tab-done" class="switch-btn" onclick="setTab('done')">L·ªäCH S·ª¨</div>
        </div>
        <div id="orderList"></div>
    </div>

    <script>
        const menuBox = document.getElementById('mainMenu');
        menuBox.innerHTML = `<a href="../index.html" class="menu-item">V·ªÅ Web Kh√°ch</a><a href="#" onclick="location.reload()" class="menu-item">L√†m M·ªõi</a>`;
        function toggleMenu() { menuBox.classList.toggle('active'); }

        let currentTab = 'active';

        function loadAdminEngine() {
            const allOrders = JSON.parse(localStorage.getItem('myHistory')) || [];
            const container = document.getElementById('orderList');
            container.innerHTML = '';
            
            let quoteNeeded = 0;

            allOrders.forEach((order, index) => {
                if (order.status === 'ƒêang x√©t gi√°') quoteNeeded++;

                // Logic Tab: Active (ƒêang x√©t gi√°, Ch·ªù x√°c nh·∫≠n, ƒêang x·ª≠ l√Ω) - Done (Th√†nh c√¥ng, H·ªßy)
                const isActive = ['ƒêang x√©t gi√°', 'Ch·ªù x√°c nh·∫≠n', 'ƒêang x·ª≠ l√Ω'].includes(order.status);
                
                if ((currentTab === 'active' && isActive) || (currentTab === 'done' && !isActive)) {
                    renderOrderCard(order, index, container);
                }
            });
            document.getElementById('quoteCount').innerText = quoteNeeded;
        }

        function renderOrderCard(order, index, container) {
            const div = document.createElement('div'); div.className = 'order-card';
            
            // X·ª≠ l√Ω hi·ªÉn th·ªã ƒë·∫∑c bi·ªát cho ƒë∆°n C√†y Thu√™
            let extraHtml = "";
            if (order.status === 'ƒêang x√©t gi√°') {
                extraHtml = `
                    <div style="margin-top:10px">
                        <label style="font-size:12px; font-weight:bold">B√°o gi√° cho kh√°ch (VNƒê):</label>
                        <input type="number" id="price-${index}" class="input-price" placeholder="Nh·∫≠p s·ªë ti·ªÅn...">
                        <button class="btn-status" style="background:#000; width:100%" onclick="setQuote(${index})">G·ª¨I B√ÅO GI√Å</button>
                    </div>
                `;
            }

            div.innerHTML = `
                <div style="display:flex; justify-content:space-between;">
                    <b style="color:#000">${order.service}</b>
                    <span class="status" style="background:#eee; font-size:11px">${order.status}</span>
                </div>
                <div class="acc-box">
                    User: <b style="color:#3b82f6">${order.acc}</b><br>
                    Pass: <b style="color:#ef4444">${order.pass}</b>
                </div>
                ${order.note ? `<div class="note-box">üìù ${order.note}</div>` : ''}
                
                ${extraHtml}

                ${(order.status === 'ƒêang x·ª≠ l√Ω') ? `
                    <div class="btn-group">
                        <button class="btn-status" style="background:#22c55e" onclick="changeStatus(${index}, 'Th√†nh c√¥ng')">HO√ÄN T·∫§T</button>
                        <button class="btn-status" style="background:#ef4444" onclick="changeStatus(${index}, 'B·ªã h·ªßy')">H·ª¶Y ƒê∆†N</button>
                    </div>
                ` : ''}
            `;
            container.appendChild(div);
        }

        function setQuote(index) {
            let priceVal = document.getElementById(`price-${index}`).value;
            if(!priceVal) return alert("Ch∆∞a nh·∫≠p gi√°!");
            
            let all = JSON.parse(localStorage.getItem('myHistory'));
            all[index].price = parseInt(priceVal);
            all[index].status = "Ch·ªù x√°c nh·∫≠n"; // Chuy·ªÉn tr·∫°ng th√°i ƒë·ªÉ kh√°ch th·∫•y
            localStorage.setItem('myHistory', JSON.stringify(all));
            alert("ƒê√£ g·ª≠i b√°o gi√° " + priceVal + "ƒë cho kh√°ch!");
            loadAdminEngine();
        }

        function changeStatus(index, status) {
            let all = JSON.parse(localStorage.getItem('myHistory'));
            all[index].status = status;
            localStorage.setItem('myHistory', JSON.stringify(all));
            loadAdminEngine();
        }

        function setTab(t) {
            currentTab = t;
            document.getElementById('tab-active').classList.toggle('active', t==='active');
            document.getElementById('tab-done').classList.toggle('active', t==='done');
            loadAdminEngine();
        }
        loadAdminEngine();
    </script>
</body>
</html>
