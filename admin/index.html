<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - GENSAI</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CSS RI√äNG CHO ADMIN ƒê·ªÇ KH·∫ÆC PH·ª§C L·ªñI HI·ªÇN TH·ªä */
        body { background: #050505; color: white; }
        .admin-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        .col-box { background: #111; border: 1px solid #333; border-radius: 12px; padding: 15px; min-height: 400px; }
        .col-header { font-weight: 800; text-transform: uppercase; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #333; color: #fff; display: flex; justify-content: space-between; }
        
        /* Th·∫ª ƒë∆°n h√†ng */
        .order-card { 
            background: #1a1a1a; 
            border: 1px solid #444; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            position: relative;
            transition: 0.2s;
        }
        .order-card:hover { border-color: #777; }
        
        .service-name { color: #22c55e; font-size: 15px; font-weight: 800; margin-bottom: 5px; text-transform: uppercase; }
        .info-row { font-size: 13px; color: #ccc; margin-bottom: 4px; }
        .highlight { color: #fff; font-weight: bold; }
        .pass-text { color: #ef4444; font-weight: bold; }
        
        .note-box { background: #252525; padding: 8px; font-size: 12px; color: #aaa; font-style: italic; border-radius: 4px; margin: 8px 0; }
        
        /* N√∫t b·∫•m */
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        .btn-admin { flex: 1; padding: 8px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; color: white; font-size: 12px; }
        .btn-img { background: #3b82f6; width: 100%; margin-top: 5px; padding: 6px; border:none; border-radius:4px; color:white; cursor:pointer; font-size:12px; }
        .btn-done { background: #22c55e; }
        .btn-cancel { background: #ef4444; }
        .btn-price { background: #eab308; color: black; }

        /* Input gi√° */
        .price-input { width: 100%; padding: 8px; background: #333; border: 1px solid #555; color: white; border-radius: 4px; margin-bottom: 5px; }

        /* Modal Xem ·∫¢nh */
        .img-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 3000; }
        .img-view { max-width: 90%; max-height: 90%; border-radius: 8px; border: 2px solid #fff; }
        .close-modal { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; }
    </style>
</head>
<body>

    <nav class="navbar" style="border-bottom: 1px solid #333; padding: 15px;">
        <div class="container" style="display:flex; justify-content:space-between; align-items:center;">
            <div style="font-weight:900; color:white; font-size:20px;">ADMIN PANEL</div>
            <button onclick="location.reload()" style="background:#333; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">L√†m m·ªõi</button>
        </div>
    </nav>

    <div class="admin-container">
        <div class="admin-grid">
            
            <div class="col-box" style="border-top: 4px solid #eab308;">
                <div class="col-header">
                    <span style="color:#eab308">1. C·∫ßn B√°o Gi√°</span>
                    <span id="count-quote">0</span>
                </div>
                <div id="list-quote">ƒêang t·∫£i d·ªØ li·ªáu...</div>
            </div>

            <div class="col-box" style="border-top: 4px solid #22c55e;">
                <div class="col-header">
                    <span style="color:#22c55e">2. Duy·ªát Gamepass</span>
                    <span id="count-gp">0</span>
                </div>
                <div id="list-gp"></div>
            </div>

            <div class="col-box" style="border-top: 4px solid #a855f7;">
                <div class="col-header">
                    <span style="color:#a855f7">3. ƒêang C√†y Thu√™</span>
                    <span id="count-boost">0</span>
                </div>
                <div id="list-boost"></div>
            </div>

        </div>
    </div>

    <div id="imgModal" class="img-modal">
        <div class="close-modal" onclick="document.getElementById('imgModal').style.display='none'">&times;</div>
        <img id="viewImg" class="img-view">
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // 1. C·∫§U H√åNH FIREBASE (D√πng ƒë√∫ng c√°i b·∫°n g·ª≠i)
        const firebaseConfig = {
            apiKey: "AIzaSyBpQ0poFExribJApkGp4poilyTfepmnj9E",
            authDomain: "gensaishop-df392.firebaseapp.com",
            projectId: "gensaishop-df392",
            storageBucket: "gensaishop-df392.firebasestorage.app",
            messagingSenderId: "561693794311",
            appId: "1:561693794311:web:b1d78102189cc30ba44aa2"
        };

        // Kh·ªüi ƒë·ªông
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Ki·ªÉm tra m·∫≠t kh·∫©u Admin
        if(prompt("Nh·∫≠p m√£ Admin:") !== "Gensai2026") {
            window.location.href = "index.html";
        }

        // 2. L·∫ÆNG NGHE D·ªÆ LI·ªÜU REAL-TIME
        db.collection("orders").orderBy("createdAt", "desc").onSnapshot((snapshot) => {
            const listQuote = document.getElementById('list-quote');
            const listGp = document.getElementById('list-gp');
            const listBoost = document.getElementById('list-boost');

            listQuote.innerHTML = ''; 
            listGp.innerHTML = ''; 
            listBoost.innerHTML = '';

            let cQuote = 0, cGp = 0, cBoost = 0;

            snapshot.forEach((doc) => {
                const data = doc.data();
                const id = doc.id;

                // --- LOGIC HI·ªÇN TH·ªä T·ª™NG LO·∫†I ƒê∆†N ---

                // 1. ƒê∆†N C·∫¶N B√ÅO GI√Å (C√†y thu√™ & Tr·∫°ng th√°i 'ƒêang x√©t gi√°')
                if (data.type === 'boost' && data.status === 'ƒêang x√©t gi√°') {
                    cQuote++;
                    listQuote.innerHTML += `
                        <div class="order-card">
                            <div class="service-name">${data.service}</div>
                            <div class="info-row">User: <span class="highlight">${data.acc}</span></div>
                            <div class="info-row">Pass: <span class="pass-text">${data.pass}</span></div>
                            
                            ${data.note ? `<div class="note-box">üìù ${data.note}</div>` : ''}
                            
                            ${data.img ? `<button class="btn-img" onclick="viewImage('${id}')"><i class="fa-solid fa-image"></i> Xem ·∫¢nh Acc</button>` : ''}
                            <input type="hidden" id="img-${id}" value="${data.img}">

                            <div style="margin-top:10px; border-top:1px solid #333; padding-top:10px">
                                <input type="number" id="price-${id}" class="price-input" placeholder="Nh·∫≠p gi√° ti·ªÅn (VNƒê)...">
                                <div class="btn-group">
                                    <button class="btn-admin btn-price" onclick="sendPrice('${id}')">G·ª≠i B√°o Gi√°</button>
                                    <button class="btn-admin btn-cancel" onclick="updateStatus('${id}', 'H·ªßy')">H·ªßy</button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // 2. DUY·ªÜT GAMEPASS (Gamepass & Ch·ªù x·ª≠ l√Ω)
                if (data.type === 'gamepass' && data.status === 'Ch·ªù x·ª≠ l√Ω') {
                    cGp++;
                    listGp.innerHTML += `
                        <div class="order-card">
                            <div class="service-name" style="color:#22c55e">${data.service}</div>
                            <div class="info-row">User: <span class="highlight">${data.acc}</span></div>
                            <div class="info-row">Gi√°: <span class="pass-text">${parseInt(data.price).toLocaleString()}ƒë</span></div>
                            
                            <div class="btn-group">
                                <button class="btn-admin btn-done" onclick="updateStatus('${id}', 'Th√†nh c√¥ng')">ƒê√£ xong</button>
                                <button class="btn-admin btn-cancel" onclick="updateStatus('${id}', 'H·ªßy')">H·ªßy</button>
                            </div>
                        </div>
                    `;
                }

                // 3. ƒêANG C√ÄY (Boost & ƒêang x·ª≠ l√Ω)
                if (data.type === 'boost' && data.status === 'ƒêang x·ª≠ l√Ω') {
                    cBoost++;
                    listBoost.innerHTML += `
                        <div class="order-card" style="border-left: 3px solid #a855f7;">
                            <div class="service-name" style="color:#a855f7">${data.service}</div>
                            <div class="info-row">User: <span class="highlight">${data.acc}</span></div>
                            <div class="info-row">Pass: <span class="pass-text">${data.pass}</span></div>
                            <div class="info-row">Gi√° ch·ªët: <span class="highlight">${parseInt(data.price).toLocaleString()}ƒë</span></div>
                            ${data.note ? `<div class="note-box">üìù ${data.note}</div>` : ''}
                            
                             ${data.img ? `<button class="btn-img" onclick="viewImage('${id}')">Xem ·∫¢nh Acc</button>` : ''}
                             <input type="hidden" id="img-${id}" value="${data.img}">

                            <div class="btn-group">
                                <button class="btn-admin btn-done" onclick="updateStatus('${id}', 'Th√†nh c√¥ng')">Ho√†n t·∫•t</button>
                                <button class="btn-admin btn-cancel" onclick="updateStatus('${id}', 'H·ªßy')">H·ªßy</button>
                            </div>
                        </div>
                    `;
                }
            });

            // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng
            document.getElementById('count-quote').innerText = cQuote;
            document.getElementById('count-gp').innerText = cGp;
            document.getElementById('count-boost').innerText = cBoost;
        });

        // 3. C√ÅC H√ÄM X·ª¨ L√ù
        
        // G·ª≠i b√°o gi√°
        function sendPrice(id) {
            const price = document.getElementById(`price-${id}`).value;
            if(!price) return alert("Vui l√≤ng nh·∫≠p gi√° ti·ªÅn!");
            
            db.collection("orders").doc(id).update({
                price: parseInt(price),
                status: "Ch·ªù x√°c nh·∫≠n" // Chuy·ªÉn tr·∫°ng th√°i ƒë·ªÉ kh√°ch nh·∫≠n th√¥ng b√°o
            }).then(() => {
                alert("ƒê√£ g·ª≠i b√°o gi√° cho kh√°ch!");
            });
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i (Xong/H·ªßy)
        function updateStatus(id, status) {
            if(confirm("X√°c nh·∫≠n chuy·ªÉn tr·∫°ng th√°i th√†nh: " + status + "?")) {
                db.collection("orders").doc(id).update({
                    status: status
                });
            }
        }

        // Xem ·∫£nh (L·∫•y t·ª´ input ·∫©n)
        function viewImage(id) {
            const imgBase64 = document.getElementById(`img-${id}`).value;
            document.getElementById('viewImg').src = imgBase64;
            document.getElementById('imgModal').style.display = 'flex';
        }

    </script>
</body>
</html>
