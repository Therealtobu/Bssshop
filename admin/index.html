<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - GENSAISHOP</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .admin-card { background: #000; color: #fff; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .order-card { background: white; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; font-size: 13px; }
        .badge-status { padding: 3px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; background: #eee; float: right; }
        .btn-act { padding: 5px 10px; border: none; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; font-size: 11px; margin-right: 5px; }
        .img-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 3000; }
    </style>
</head>
<body>
    <script>if(prompt("Mật mã Admin:")!=="Gensai2026"){alert("Sai!");window.location.href="../index.html";}</script>
    <nav class="navbar"><div class="container nav-inner"><div class="logo">GENSAI ADMIN</div><div class="menu-toggle" onclick="location.reload()"><i class="fa-solid fa-rotate-right"></i></div></div></nav>
    
    <div class="container">
        <div class="admin-grid">
            
            <div class="admin-col" style="border-top: 4px solid #facc15;">
                <div class="col-title" style="color:#b45309">1. Cần Báo Giá <span id="count-quote">0</span></div>
                <div id="list-quote"></div>
            </div>

            <div class="admin-col" style="border-top: 4px solid #22c55e;">
                <div class="col-title" style="color:#15803d">2. Duyệt Gamepass <span id="count-gp">0</span></div>
                <div id="list-gp"></div>
            </div>

            <div class="admin-col" style="border-top: 4px solid #a855f7;">
                <div class="col-title" style="color:#7e22ce">3. Cày Thuê Đang Làm <span id="count-boost">0</span></div>
                <div id="list-boost"></div>
            </div>

        </div>
    </div>

    <div id="imgModal" class="img-modal" onclick="this.style.display='none'">
        <img id="viewImg" style="max-width:90%; max-height:90%; border-radius:10px;">
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
apiKey: "AIzaSyBpQ0poFExribJApkGp4poilyTfepmnj9E",  // <--- THAY CÁI CỦA BẠN VÀO ĐÂY
        authDomain: "gensaishop-df392.firebaseapp.com",
        projectId: "gensaishop-df392",
        storageBucket: "gensaishop-df392.firebasestorage.app",
        messagingSenderId: "561693794311",
        appId: "1:561693794311:web:b1d78102189cc30ba44aa2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // KIỂM TRA PASS ADMIN
    if(prompt("Code:") !== "Gensai2026") window.location.href="../index.html";

    // --- LẮNG NGHE ĐƠN HÀNG REAL-TIME ---
    // Lấy tất cả đơn, sắp xếp mới nhất lên đầu
    const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));

    onSnapshot(q, (snapshot) => {
        const listQuote = document.getElementById('list-quote');
        const listGp = document.getElementById('list-gp');
        const listBoost = document.getElementById('list-boost');

        listQuote.innerHTML = ''; listGp.innerHTML = ''; listBoost.innerHTML = '';
        
        snapshot.forEach((docData) => {
            const order = docData.data();
            const id = docData.id; // ID của đơn hàng

            // CODE HTML HIỂN THỊ (Giống hệt cũ, chỉ đổi cách gọi hàm update)
            // Ví dụ phần Cày Thuê:
            if(order.type === 'boost' && order.status === 'Đang xét giá') {
                listQuote.innerHTML += `
                    <div class="order-card">
                        <b>${order.service}</b><br>
                        User: ${order.acc} | Pass: ${order.pass}
                        <input type="number" id="price-${id}" placeholder="Giá...">
                        <button onclick="window.setPrice('${id}')">Gửi Báo Giá</button>
                    </div>
                `;
            }
            // ... (Làm tương tự cho các mục khác)
        });
    });

    // --- HÀM CẬP NHẬT TRẠNG THÁI ---
    window.setPrice = async function(id) {
        const price = document.getElementById(`price-${id}`).value;
        await updateDoc(doc(db, "orders", id), {
            price: parseInt(price),
            status: "Chờ xác nhận"
        });
        alert("Đã báo giá!"); // Bên khách sẽ tự nảy thông báo ngay
    }

    window.updateStatus = async function(id, status) {
        await updateDoc(doc(db, "orders", id), { status: status });
    }
</script>
</body>
</html>
