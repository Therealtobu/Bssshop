<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - GENSAISHOP</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .admin-card { background: #000; color: #fff; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .order-card { background: white; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; font-size: 13px; }
        .badge-status { padding: 3px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; background: #eee; float: right; }
        .btn-act { padding: 5px 10px; border: none; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; font-size: 11px; margin-right: 5px; }
        .img-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 3000; }
    </style>
</head>
<body>
    <script>if(prompt("Mật mã Admin:")!=="Gensai2026"){alert("Sai!");window.location.href="../index.html";}</script>
    <nav class="navbar"><div class="container nav-inner"><div class="logo">GENSAI ADMIN</div><div class="menu-toggle" onclick="location.reload()"><i class="fa-solid fa-rotate-right"></i></div></div></nav>
    
    <div class="container">
        <div class="admin-grid">
            
            <div class="admin-col" style="border-top: 4px solid #facc15;">
                <div class="col-title" style="color:#b45309">1. Cần Báo Giá <span id="count-quote">0</span></div>
                <div id="list-quote"></div>
            </div>

            <div class="admin-col" style="border-top: 4px solid #22c55e;">
                <div class="col-title" style="color:#15803d">2. Duyệt Gamepass <span id="count-gp">0</span></div>
                <div id="list-gp"></div>
            </div>

            <div class="admin-col" style="border-top: 4px solid #a855f7;">
                <div class="col-title" style="color:#7e22ce">3. Cày Thuê Đang Làm <span id="count-boost">0</span></div>
                <div id="list-boost"></div>
            </div>

        </div>
    </div>

    <div id="imgModal" class="img-modal" onclick="this.style.display='none'">
        <img id="viewImg" style="max-width:90%; max-height:90%; border-radius:10px;">
    </div>

    <script>
        function loadAdmin() {
            const history = JSON.parse(localStorage.getItem('myHistory')) || [];
            
            const listQuote = document.getElementById('list-quote');
            const listGp = document.getElementById('list-gp');
            const listBoost = document.getElementById('list-boost');
            
            listQuote.innerHTML = ''; listGp.innerHTML = ''; listBoost.innerHTML = '';
            let cQuote = 0, cGp = 0, cBoost = 0;

            history.forEach((o, i) => {
                // 1. CẦN BÁO GIÁ (Chỉ đơn Boost và trạng thái 'Đang xét giá')
                if(o.type === 'boost' && o.status === 'Đang xét giá') {
                    cQuote++;
                    listQuote.innerHTML += `
                        <div class="order-card">
                            <b>${o.service}</b>
                            <div style="margin:5px 0; color:#555">User: ${o.acc}</div>
                            ${o.note ? `<div style="background:#fffbeb; padding:5px; margin-bottom:5px; font-size:11px">${o.note}</div>` : ''}
                            ${o.img ? `<button onclick="viewImage('${o.img}')" style="background:#3b82f6; color:white; border:none; padding:4px; border-radius:4px; font-size:10px; cursor:pointer">Xem ảnh Acc</button>` : ''}
                            <div style="margin-top:10px; display:flex;">
                                <input type="number" id="price-${i}" placeholder="Nhập giá tiền..." style="width:70%; padding:5px; border:1px solid #ddd; border-radius:4px">
                                <button onclick="setPrice(${i})" style="width:30%; background:#000; color:white; border:none; border-radius:4px; margin-left:5px; cursor:pointer">Gửi</button>
                            </div>
                        </div>`;
                }

                // 2. GAMEPASS (Chờ xử lý hoặc Đang xử lý)
                if(o.type === 'gamepass' && (o.status === 'Chờ xử lý' || o.status === 'Đang xử lý')) {
                    cGp++;
                    listGp.innerHTML += `
                        <div class="order-card">
                            <span class="badge-status">${o.status}</span>
                            <b>${o.service}</b><br>
                            User: <b style="color:blue">${o.acc}</b>
                            <div style="margin-top:8px">
                                <button class="btn-act" style="background:#22c55e" onclick="update(${i}, 'Thành công')">Xong</button>
                                <button class="btn-act" style="background:#ef4444" onclick="update(${i}, 'Bị hủy')">Hủy</button>
                            </div>
                        </div>`;
                }

                // 3. CÀY THUÊ (Chỉ hiện khi khách đã đồng ý giá -> Status 'Đang xử lý')
                if(o.type === 'boost' && o.status === 'Đang xử lý') {
                    cBoost++;
                    listBoost.innerHTML += `
                        <div class="order-card">
                            <b style="color:#a855f7">${o.service}</b> (Giá: ${o.price.toLocaleString()}đ)<br>
                            Acc: <b>${o.acc}</b> | Pass: <b style="color:red">${o.pass}</b>
                            ${o.note ? `<div style="font-size:11px; color:#666; margin:5px 0">${o.note}</div>` : ''}
                            ${o.img ? `<button onclick="viewImage('${o.img}')" style="margin-bottom:5px; cursor:pointer">Xem ảnh</button>` : ''}
                            <div style="margin-top:5px">
                                <button class="btn-act" style="background:#22c55e" onclick="update(${i}, 'Thành công')">Hoàn tất</button>
                                <button class="btn-act" style="background:#ef4444" onclick="update(${i}, 'Bị hủy')">Hủy</button>
                            </div>
                        </div>`;
                }
            });

            document.getElementById('count-quote').innerText = cQuote;
            document.getElementById('count-gp').innerText = cGp;
            document.getElementById('count-boost').innerText = cBoost;
        }

        function setPrice(index) {
            let p = document.getElementById(`price-${index}`).value;
            if(!p) return alert("Nhập giá đi!");
            let h = JSON.parse(localStorage.getItem('myHistory'));
            h[index].price = parseInt(p);
            h[index].status = "Chờ xác nhận"; // Đổi trạng thái để Chuông bên User báo đỏ
            localStorage.setItem('myHistory', JSON.stringify(h));
            alert("Đã báo giá! Đợi khách đồng ý.");
            loadAdmin();
        }

        function update(index, status) {
            let h = JSON.parse(localStorage.getItem('myHistory'));
            h[index].status = status;
            localStorage.setItem('myHistory', JSON.stringify(h));
            loadAdmin();
        }

        function viewImage(base64) {
            document.getElementById('viewImg').src = base64;
            document.getElementById('imgModal').style.display = 'flex';
        }

        loadAdmin();
    </script>
</body>
</html>
